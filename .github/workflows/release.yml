# yaml-language-server: $schema=https://json.schemastore.org/github-workflow.json
---
name: debug-release
run-name: debug-release ${{ github.sha }} by @${{ github.actor }}

on:
  push:
    branches:
      - test-main

jobs:
  debug-merge:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 20 # enough to see recent history

      - name: Print commit message and metadata
        run: |
          echo "ğŸ” Commit SHA: ${{ github.sha }}"
          echo "ğŸ“ Commit Message:"
          git log -1 --pretty=%B

      - name: Show parent commit(s)
        run: |
          echo "ğŸ”— Parent Commits:"
          git rev-list --parents -n 1 ${{ github.sha }}

      - name: Show if merge commit
        run: |
          COUNT=$(git rev-list --parents -n 1 ${{ github.sha }} | wc -w)
          if [ "$COUNT" -eq 3 ]; then
            echo "âœ… This is a merge commit."
          else
            echo "â„¹ï¸ This is NOT a merge commit (likely squash or rebase)."
          fi

      - name: Print parent commit info
        run: |
          PARENTS=$(git rev-list --parents -n 1 ${{ github.sha }})
          MERGED_COMMIT=$(echo "$PARENTS" | cut -d' ' -f3)
          echo "ğŸ§¬ Merged Commit SHA (2nd parent): $MERGED_COMMIT"
          echo "ğŸ”– Branch pointing to that commit (if any):"
          git branch -r --contains $MERGED_COMMIT || echo "(no remote branches contain it)"

      - name: Print commit history (last 5)
        run: |
          echo "ğŸ“œ Last 5 commits on debug-main:"
          git log -n 5 --graph --oneline --decorate
